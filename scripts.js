var itemImageMap = {
  "Axe Azurite": "it_jb_axe_02.png",
  "Axe Charoite": "it_jb_axe_03.png",
  "Axe Citrine": "it_jb_axe_04.png",
  "Axe Jadeite": "it_jb_axe_01.png",
  "Black Mage's Memory (Blue)": [
    "itemicon_job_02.png",
    "job/blm_item.png"
  ],
  "Black Mage's Memory (Green)": [
    "itemicon_job_01.png",
    "job/blm_item.png"
  ],
  "Black Mage's Memory (Purple)": [
    "itemicon_job_03.png",
    "job/blm_item.png"
  ],
  "Black Mage's Memory (Yellow)": [
    "itemicon_job_04.png",
    "job/blm_item.png"
  ],
  "Blue Spiritsand": "it_af_mat_sand_02.png",
  "Bow Azurite": "it_jb_bow_02.png",
  "Bow Charoite": "it_jb_bow_03.png",
  "Bow Citrine": "it_jb_bow_04.png",
  "Bow Jadeite": "it_jb_bow_01.png",
  "Capella Crafting Recipe": [
    "itemicon_recipe.png",
    "gear/lapswpn_gun_001.png"
  ],
  "Circlet Crafting Recipe": [
    "itemicon_recipe.png",
    "gear/lapswpn_hat_003.png"
  ],
  "Claymore Crafting Recipe": [
    "itemicon_recipe.png",
    "gear/lapswpn_bsw_001.png"
  ],
  "Clear Sap": "it_af_mat_sap_02.png",
  "Cleric's Memory (Blue)": [
    "itemicon_job_02.png",
    "job/clr_item.png"
  ],
  "Cleric's Memory (Green)": [
    "itemicon_job_01.png",
    "job/clr_item.png"
  ],
  "Cleric's Memory (Purple)": [
    "itemicon_job_03.png",
    "job/clr_item.png"
  ],
  "Cleric's Memory (Yellow)": [
    "itemicon_job_04.png",
    "job/clr_item.png"
  ],
  "Cloudy Sap": "it_af_mat_sap_01.png",
  "Dagger Azurite": "it_jb_ssword_02.png",
  "Dagger Charoite": "it_jb_ssword_03.png",
  "Dagger Citrine": "it_jb_ssword_04.png",
  "Dagger Crafting Recipe": [
    "itemicon_recipe.png",
    "gear/lapswpn_dag_001.png"
  ],
  "Dagger Jadeite": "it_jb_ssword_01.png",
  "Dark Alcryst (Blue)": "it_jb_em_dark_2.png",
  "Dark Alcryst (Green)": "it_jb_em_dark_1.png",
  "Dark Alcryst (Purple)": "it_jb_em_dark_3.png",
  "Dark Alcryst (Yellow)": "it_jb_em_dark_4.png",
  "Dragoon's Memory (Blue)": [
    "itemicon_job_02.png",
    "job/drg_item.png"
  ],
  "Dragoon's Memory (Green)": [
    "itemicon_job_01.png",
    "job/drg_item.png"
  ],
  "Dragoon's Memory (Purple)": [
    "itemicon_job_03.png",
    "job/drg_item.png"
  ],
  "Dragoon's Memory (Yellow)": [
    "itemicon_job_04.png",
    "job/drg_item.png"
  ],
  "Earth Alcryst (Blue)": "it_jb_em_soil_2.png",
  "Earth Alcryst (Green)": "it_jb_em_soil_1.png",
  "Earth Alcryst (Purple)": "it_jb_em_soil_3.png",
  "Earth Alcryst (Yellow)": "it_jb_em_soil_4.png",
  "Faint Memory (Blue)": "it_jb_mm_all_2.png",
  "Faint Memory (Green)": "it_jb_mm_all.png",
  "Faint Memory (Purple)": "it_jb_mm_all_3.png",
  "Faint Memory (Yellow)": "it_jb_mm_all_4.png",
  "Fairy Ring Crafting Recipe": [
    "itemicon_recipe.png",
    "gear/lapswpn_rng_003.png"
  ],
  "Fire Alcryst (Blue)": "it_jb_em_fire_2.png",
  "Fire Alcryst (Green)": "it_jb_em_fire_1.png",
  "Fire Alcryst (Purple)": "it_jb_em_fire_3.png",
  "Fire Alcryst (Yellow)": "it_jb_em_fire_4.png",
  "Fists Azurite": "it_jb_fist_02.png",
  "Fists Charoite": "it_jb_fist_03.png",
  "Fists Citrine": "it_jb_fist_04.png",
  "Fists Jadeite": "it_jb_fist_01.png",
  "Great Bow Crafting Recipe": [
    "itemicon_recipe.png",
    "gear/lapswpn_bow_002.png"
  ],
  "Greatsword Azurite": "it_jb_lsword_02.png",
  "Greatsword Charoite": "it_jb_lsword_03.png",
  "Greatsword Citrine": "it_jb_lsword_04.png",
  "Greatsword Jadeite": "it_jb_lsword_01.png",
  "Green Mage's Memory (Blue)": [
    "itemicon_job_02.png",
    "job/grm_item.png"
  ],
  "Green Mage's Memory (Green)": [
    "itemicon_job_01.png",
    "job/grm_item.png"
  ],
  "Green Mage's Memory (Purple)": [
    "itemicon_job_03.png",
    "job/grm_item.png"
  ],
  "Green Mage's Memory (Yellow)": [
    "itemicon_job_04.png",
    "job/grm_item.png"
  ],
  "Grey Spiritsand": "it_af_mat_sand_01.png",
  "Gun Azurite": "it_jb_gun_02.png",
  "Gun Charoite": "it_jb_gun_03.png",
  "Gun Citrine": "it_jb_gun_04.png",
  "Gun Jadeite": "it_jb_gun_01.png",
  "Gunner's Memory (Blue)": [
    "itemicon_job_02.png",
    "job/gun_item.png"
  ],
  "Gunner's Memory (Green)": [
    "itemicon_job_01.png",
    "job/gun_item.png"
  ],
  "Gunner's Memory (Purple)": [
    "itemicon_job_03.png",
    "job/gun_item.png"
  ],
  "Gunner's Memory (Yellow)": [
    "itemicon_job_04.png",
    "job/gun_item.png"
  ],
  "Hero's Ring Crafting Recipe": [
    "itemicon_recipe.png",
    "gear/lapswpn_rng_002.png"
  ],
  "Ice Alcryst (Blue)": "it_jb_em_ice_2.png",
  "Ice Alcryst (Green)": "it_jb_em_ice_1.png",
  "Ice Alcryst (Purple)": "it_jb_em_ice_3.png",
  "Ice Alcryst (Yellow)": "it_jb_em_ice_4.png",
  "Iron Helm Crafting Recipe": [
    "itemicon_recipe.png",
    "gear/lapswpn_hlm_002.png"
  ],
  "Iron Mace Crafting Recipe": [
    "itemicon_recipe.png",
    "gear/lapswpn_mac_001.png"
  ],
  "Iron Plate Crafting Recipe": [
    "itemicon_recipe.png",
    "gear/lapswpn_arm_002.png"
  ],
  "Iron Rod Crafting Recipe": [
    "itemicon_recipe.png",
    "gear/lapswpn_rod_002.png"
  ],
  "Katana Azurite": "it_jb_jsword_02.png",
  "Katana Charoite": "it_jb_jsword_03.png",
  "Katana Citrine": "it_jb_jsword_04.png",
  "Katana Jadeite": "it_jb_jsword_01.png",
  "Kiku-ichimonji Crafting Recipe": [
    "itemicon_recipe.png",
    "gear/lapswpn_kat_002.png"
  ],
  "Knight's Memory (Blue)": [
    "itemicon_job_02.png",
    "job/knt_item.png"
  ],
  "Knight's Memory (Green)": [
    "itemicon_job_01.png",
    "job/knt_item.png"
  ],
  "Knight's Memory (Purple)": [
    "itemicon_job_03.png",
    "job/knt_item.png"
  ],
  "Knight's Memory (Yellow)": [
    "itemicon_job_04.png",
    "job/knt_item.png"
  ],
  "Kodachi Crafting Recipe": [
    "itemicon_recipe.png",
    "gear/lapswpn_nkn_002.png"
  ],
  "Kotetsu Crafting Recipe": [
    "itemicon_recipe.png",
    "gear/lapswpn_kat_001.png"
  ],
  "Kunai Crafting Recipe": [
    "itemicon_recipe.png",
    "gear/lapswpn_nkn_001.png"
  ],
  "Lancer's Memory (Blue)": [
    "itemicon_job_02.png",
    "job/lan_item.png"
  ],
  "Lancer's Memory (Green)": [
    "itemicon_job_01.png",
    "job/lan_item.png"
  ],
  "Lancer's Memory (Purple)": [
    "itemicon_job_03.png",
    "job/lan_item.png"
  ],
  "Lancer's Memory (Yellow)": [
    "itemicon_job_04.png",
    "job/lan_item.png"
  ],
  "Light Alcryst (Blue)": "it_jb_em_shine_2.png",
  "Light Alcryst (Green)": "it_jb_em_shine_1.png",
  "Light Alcryst (Purple)": "it_jb_em_shine_3.png",
  "Light Alcryst (Yellow)": "it_jb_em_shine_4.png",
  "Lightning Alcryst (Blue)": "it_jb_em_thunder_2.png",
  "Lightning Alcryst (Green)": "it_jb_em_thunder_1.png",
  "Lightning Alcryst (Purple)": "it_jb_em_thunder_3.png",
  "Lightning Alcryst (Yellow)": "it_jb_em_thunder_4.png",
  "Long Bow Crafting Recipe": [
    "itemicon_recipe.png",
    "gear/lapswpn_bow_001.png"
  ],
  "Longsword Crafting Recipe": [
    "itemicon_recipe.png",
    "gear/lapswpn_swo_001.png"
  ],
  "Mace Azurite": "it_jb_mace_02.png",
  "Mace Charoite": "it_jb_mace_03.png",
  "Mace Citrine": "it_jb_mace_04.png",
  "Mace Jadeite": "it_jb_mace_01.png",
  "Metal Knuckles Crafting Recipe": [
    "itemicon_recipe.png",
    "gear/lapswpn_fis_001.png"
  ],
  "Mirage Vest Crafting Recipe": [
    "itemicon_recipe.png",
    "gear/lapswpn_clt_003.png"
  ],
  "Monk's Memory (Blue)": [
    "itemicon_job_02.png",
    "job/mnk_item.png"
  ],
  "Monk's Memory (Green)": [
    "itemicon_job_01.png",
    "job/mnk_item.png"
  ],
  "Monk's Memory (Purple)": [
    "itemicon_job_03.png",
    "job/mnk_item.png"
  ],
  "Monk's Memory (Yellow)": [
    "itemicon_job_04.png",
    "job/mnk_item.png"
  ],
  "Murky Fluid": "it_af_mat_liquid_01.png",
  "Mythril Armor Crafting Recipe": [
    "itemicon_recipe.png",
    "gear/lapswpn_arm_003.png"
  ],
  "Mythril Claws Crafting Recipe": [
    "itemicon_recipe.png",
    "gear/lapswpn_fis_002.png"
  ],
  "Mythril Dagger Crafting Recipe": [
    "itemicon_recipe.png",
    "gear/lapswpn_dag_002.png"
  ],
  "Mythril Helm Crafting Recipe": [
    "itemicon_recipe.png",
    "gear/lapswpn_hlm_003.png"
  ],
  "Mythril Mace Crafting Recipe": [
    "itemicon_recipe.png",
    "gear/lapswpn_mac_002.png"
  ],
  "Mythril Saber Crafting Recipe": [
    "itemicon_recipe.png",
    "gear/lapswpn_bsw_002.png"
  ],
  "Mythril Spear Crafting Recipe": [
    "itemicon_recipe.png",
    "gear/lapswpn_spe_002.png"
  ],
  "Mythril Sword Crafting Recipe": [
    "itemicon_recipe.png",
    "gear/lapswpn_swo_002.png"
  ],
  "Ninja Blade Azurite": "it_jb_kunai_02.png",
  "Ninja Blade Charoite": "it_jb_kunai_03.png",
  "Ninja Blade Citrine": "it_jb_kunai_04.png",
  "Ninja Blade Jadeite": "it_jb_kunai_01.png",
  "Ninja's Memory (Blue)": [
    "itemicon_job_02.png",
    "job/nin_item.png"
  ],
  "Ninja's Memory (Green)": [
    "itemicon_job_01.png",
    "job/nin_item.png"
  ],
  "Ninja's Memory (Purple)": [
    "itemicon_job_03.png",
    "job/nin_item.png"
  ],
  "Ninja's Memory (Yellow)": [
    "itemicon_job_04.png",
    "job/nin_item.png"
  ],
  "Paladin's Memory (Blue)": [
    "itemicon_job_02.png",
    "job/pld_item.png"
  ],
  "Paladin's Memory (Green)": [
    "itemicon_job_01.png",
    "job/pld_item.png"
  ],
  "Paladin's Memory (Purple)": [
    "itemicon_job_03.png",
    "job/pld_item.png"
  ],
  "Paladin's Memory (Yellow)": [
    "itemicon_job_04.png",
    "job/pld_item.png"
  ],
  "Partisan Crafting Recipe": [
    "itemicon_recipe.png",
    "gear/lapswpn_spe_001.png"
  ],
  "Platinum Rod Crafting Recipe": [
    "itemicon_recipe.png",
    "gear/lapswpn_rod_005.png"
  ],
  "Praying Angel Statue (Blue)": "it_jb_im_angel_2.png",
  "Praying Angel Statue (Green)": "it_jb_im_angel_1.png",
  "Praying Angel Statue (Purple)": "it_jb_im_angel_3.png",
  "Praying Angel Statue (Yellow)": "it_jb_im_angel_4.png",
  "Prowling Wyvern Statue (Blue)": "it_jb_im_dragon_2.png",
  "Prowling Wyvern Statue (Green)": "it_jb_im_dragon_1.png",
  "Prowling Wyvern Statue (Purple)": "it_jb_im_dragon_3.png",
  "Prowling Wyvern Statue (Yellow)": "it_jb_im_dragon_4.png",
  "Raging Heart": "it_af_mat_heart_02.png",
  "Ranger's Memory (Blue)": [
    "itemicon_job_02.png",
    "job/hun_item.png"
  ],
  "Ranger's Memory (Green)": [
    "itemicon_job_01.png",
    "job/hun_item.png"
  ],
  "Ranger's Memory (Purple)": [
    "itemicon_job_03.png",
    "job/hun_item.png"
  ],
  "Ranger's Memory (Yellow)": [
    "itemicon_job_04.png",
    "job/hun_item.png"
  ],
  "Red Mage's Memory (Blue)": [
    "itemicon_job_02.png",
    "job/rdm_item.png"
  ],
  "Red Mage's Memory (Green)": [
    "itemicon_job_01.png",
    "job/rdm_item.png"
  ],
  "Red Mage's Memory (Purple)": [
    "itemicon_job_03.png",
    "job/rdm_item.png"
  ],
  "Red Mage's Memory (Yellow)": [
    "itemicon_job_04.png",
    "job/rdm_item.png"
  ],
  "Samurai's Memory (Blue)": [
    "itemicon_job_02.png",
    "job/sam_item.png"
  ],
  "Samurai's Memory (Green)": [
    "itemicon_job_01.png",
    "job/sam_item.png"
  ],
  "Samurai's Memory (Purple)": [
    "itemicon_job_03.png",
    "job/sam_item.png"
  ],
  "Samurai's Memory (Yellow)": [
    "itemicon_job_04.png",
    "job/sam_item.png"
  ],
  "Scholar Robe Crafting Recipe": [
    "itemicon_recipe.png",
    "gear/lapswpn_clt_002.png"
  ],
  "Soldier's Memory (Blue)": [
    "itemicon_job_02.png",
    "job/swn_item.png"
  ],
  "Soldier's Memory (Green)": [
    "itemicon_job_01.png",
    "job/swn_item.png"
  ],
  "Soldier's Memory (Purple)": [
    "itemicon_job_03.png",
    "job/swn_item.png"
  ],
  "Soldier's Memory (Yellow)": [
    "itemicon_job_04.png",
    "job/swn_item.png"
  ],
  "Sorrowful Heart": "it_af_mat_heart_01.png",
  "Spear Azurite": "it_jb_spear_02.png",
  "Spear Charoite": "it_jb_spear_03.png",
  "Spear Citrine": "it_jb_spear_04.png",
  "Spear Jadeite": "it_jb_spear_01.png",
  "Spellblade's Memory (Blue)": [
    "itemicon_job_02.png",
    "job/mgk_item.png"
  ],
  "Spellblade's Memory (Green)": [
    "itemicon_job_01.png",
    "job/mgk_item.png"
  ],
  "Spellblade's Memory (Purple)": [
    "itemicon_job_03.png",
    "job/mgk_item.png"
  ],
  "Spellblade's Memory (Yellow)": [
    "itemicon_job_04.png",
    "job/mgk_item.png"
  ],
  "Staff Azurite": "it_jb_staff_02.png",
  "Staff Charoite": "it_jb_staff_03.png",
  "Staff Citrine": "it_jb_staff_04.png",
  "Staff Jadeite": "it_jb_staff_01.png",
  "Sticky Fluid": "it_af_mat_liquid_02.png",
  "Sword Azurite": "it_jb_sword_02.png",
  "Sword Charoite": "it_jb_sword_03.png",
  "Sword Citrine": "it_jb_sword_04.png",
  "Sword Jadeite": "it_jb_sword_01.png",
  "Thief's Memory (Blue)": [
    "itemicon_job_02.png",
    "job/thi_item.png"
  ],
  "Thief's Memory (Green)": [
    "itemicon_job_01.png",
    "job/thi_item.png"
  ],
  "Thief's Memory (Purple)": [
    "itemicon_job_03.png",
    "job/thi_item.png"
  ],
  "Thief's Memory (Yellow)": [
    "itemicon_job_04.png",
    "job/thi_item.png"
  ],
  "Time Mage's Memory (Blue)": [
    "itemicon_job_02.png",
    "job/tim_item.png"
  ],
  "Time Mage's Memory (Green)": [
    "itemicon_job_01.png",
    "job/tim_item.png"
  ],
  "Time Mage's Memory (Purple)": [
    "itemicon_job_03.png",
    "job/tim_item.png"
  ],
  "Time Mage's Memory (Yellow)": [
    "itemicon_job_04.png",
    "job/tim_item.png"
  ],
  "Viking's Memory (Blue)": [
    "itemicon_job_02.png",
    "job/vik_item.png"
  ],
  "Viking's Memory (Green)": [
    "itemicon_job_01.png",
    "job/vik_item.png"
  ],
  "Viking's Memory (Purple)": [
    "itemicon_job_03.png",
    "job/vik_item.png"
  ],
  "Viking's Memory (Yellow)": [
    "itemicon_job_04.png",
    "job/vik_item.png"
  ],
  "Vega Crafting Recipe": [
    "itemicon_recipe.png",
    "gear/lapswpn_gun_002.png"
  ],
  "Warrior's Memory (Blue)": [
    "itemicon_job_02.png",
    "job/war_item.png"
  ],
  "Warrior's Memory (Green)": [
    "itemicon_job_01.png",
    "job/war_item.png"
  ],
  "Warrior's Memory (Purple)": [
    "itemicon_job_03.png",
    "job/war_item.png"
  ],
  "Warrior's Memory (Yellow)": [
    "itemicon_job_04.png",
    "job/war_item.png"
  ],
  "Water Alcryst (Blue)": "it_jb_em_water_2.png",
  "Water Alcryst (Green)": "it_jb_em_water_1.png",
  "Water Alcryst (Purple)": "it_jb_em_water_3.png",
  "Water Alcryst (Yellow)": "it_jb_em_water_4.png",
  "White Mage's Memory (Blue)": [
    "itemicon_job_02.png",
    "job/whm_item.png"
  ],
  "White Mage's Memory (Green)": [
    "itemicon_job_01.png",
    "job/whm_item.png"
  ],
  "White Mage's Memory (Purple)": [
    "itemicon_job_03.png",
    "job/whm_item.png"
  ],
  "White Mage's Memory (Yellow)": [
    "itemicon_job_04.png",
    "job/whm_item.png"
  ],
  "Wind Alcryst (Blue)": "it_jb_em_wind_2.png",
  "Wind Alcryst (Green)": "it_jb_em_wind_1.png",
  "Wind Alcryst (Purple)": "it_jb_em_wind_3.png",
  "Wind Alcryst (Yellow)": "it_jb_em_wind_4.png",
  "Winged One's Memory (Blue)": [
    "itemicon_job_02.png",
    "job/lapsglms_item.png"
  ],
  "Winged One's Memory (Green)": [
    "itemicon_job_01.png",
    "job/lapsglms_item.png"
  ],
  "Winged One's Memory (Purple)": [
    "itemicon_job_03.png",
    "job/lapsglms_item.png"
  ],
  "Winged One's Memory (Yellow)": [
    "itemicon_job_04.png",
    "job/lapsglms_item.png"
  ],
  "Wizard's Hat Crafting Recipe": [
    "itemicon_recipe.png",
    "gear/lapswpn_hat_002.png"
  ],
  "Ogrekiller Crafting Recipe": [
    "itemicon_recipe.png",
    "gear/lapswpn_axe_001.png"
  ],
  "Mythril Axe Crafting Recipe": [
    "itemicon_recipe.png",
    "gear/lapswpn_axe_002.png"
  ]

};

var weaponTierNames = [
  'Jadeite',
  'Azurite',
  'Charoite',
  'Citrine',
  //'Spinel',
];

var colorTierNames = [
  'Green',
  'Blue',
  'Purple',
  'Yellow',
  //'Red',
];

var elements = [
  'Dark',
  'Earth',
  'Fire',
  'Ice',
  'Light',
  'Lightning',
  'Water',
  'Wind',
];

var elementMap = {};
elements.forEach(function (element) {
  elementMap[element] = [];
  colorTierNames.forEach(function (colorTier) {
    elementMap[element].push(element + ' Alcryst (' + colorTier + ')');
  });
});


var jobMaterialTypeMap = {
  'Black Mage': {
    'statue': 'Prowling Wyvern Statue',
    'weapon': 'Staff',
    'job': 'Black Mage',
  },
  'Cleric': {
    'statue': 'Prowling Wyvern Statue',
    'weapon': 'Mace',
    'job': 'Cleric',
  },
  'Dark Knight': {
    'statue': 'Prowling Wyvern Statue',
    'weapon': 'Sword',
    'job': 'Dark Knight',
  },
  'Dragoon': {
    'statue': 'Prowling Wyvern Statue',
    'weapon': 'Spear',
    'job': 'Dragoon',
  },
  'Green Mage': {
    'statue': 'Praying Angel Statue',
    'weapon': 'Staff',
    'job': 'Green Mage',
  },
  'Gunbreaker': {
    'statue': 'Prowling Wyvern Statue',
    'weapon': 'Sword',
    'job': 'Gunbreaker',
  },
  'Gunner': {
    'statue': 'Prowling Wyvern Statue',
    'weapon': 'Gun',
    'job': 'Gunner',
  },
  'Ranger': {
    'statue': 'Praying Angel Statue',
    'weapon': 'Bow',
    'job': 'Ranger',
  },
  'Knight': {
    'statue': 'Prowling Wyvern Statue',
    'weapon': 'Sword',
    'job': 'Knight',
  },
  'Lancer': {
    'statue': 'Praying Angel Statue',
    'weapon': 'Spear',
    'job': 'Lancer',
  },
  'Lord': {
    'statue': 'Praying Angel Statue',
    'weapon': 'Sword',
    'job': 'Warrior',
  },
  'Monk': {
    'statue': 'Prowling Wyvern Statue',
    'weapon': 'Fists',
    'job': 'Monk',
  },
  'Ninja': {
    'statue': 'Prowling Wyvern Statue',
    'weapon': 'Ninja Blade',
    'job': 'Ninja',
  },
  'Paladin': {
    'statue': 'Praying Angel Statue',
    'weapon': 'Sword',
    'job': 'Paladin',
  },
  'Red Mage': {
    'statue': 'Prowling Wyvern Statue',
    'weapon': 'Sword',
    'job': 'Red Mage',
  },
  'Samurai': {
    'statue': 'Prowling Wyvern Statue',
    'weapon': 'Katana',
    'job': 'Samurai',
  },
  'Squire': {
    'statue': 'Praying Angel Statue',
    'weapon': 'Sword',
    'job': 'Squire',
  },
  'Soldier': {
    'statue': 'Prowling Wyvern Statue',
    'weapon': 'Greatsword',
    'job': 'Soldier',
  },
  'Sorceress': {
    'statue': 'Praying Angel Statue',
    'weapon': 'Staff',
    'job': 'Sorceress',
  },
  'Spellblade': {
    'statue': 'Praying Angel Statue',
    'weapon': 'Sword',
    'job': 'Spellblade',
  },
  'Sword Saint': {
    'statue': 'Praying Angel Statue',
    'weapon': 'Sword',
    'job': 'Sword Saint',
  },
  'Thief': {
    'statue': 'Praying Angel Statue',
    'weapon': 'Dagger',
    'job': 'Thief',
  },
  'Time Mage': {
    'statue': 'Praying Angel Statue',
    'weapon': 'Staff',
    'job': 'Time Mage',
  },
  'Viking': {
    'statue': 'Prowling Wyvern Statue',
    'weapon': 'Axe',
    'job': 'Viking',
  },
  'Warrior': {
    'statue': 'Praying Angel Statue',
    'weapon': 'Sword',
    'job': 'Warrior',
  },
  'White Mage': {
    'statue': 'Praying Angel Statue',
    'weapon': 'Staff',
    'job': 'White Mage',
  },
  'White Mage of Lapis': {
    'statue': 'Praying Angel Statue',
    'weapon': 'Bow',
    'job': 'White Mage',
  },
  'Winged One': {
    'statue': 'Prowling Wyvern Statue',
    'weapon': 'Sword',
    'job': 'Winged One',
  },
};

// Convert the flat mapping to the full item names as an array.
var jobMats = {};
for (let [jobName, jobMatTypes] of Object.entries(jobMaterialTypeMap)) {
  jobMats[jobName] = [];

  colorTierNames.forEach(function (colorTier) {
    jobMats[jobName].push(jobMatTypes['statue'] + ' (' + colorTier + ')');
  });

  colorTierNames.forEach(function (colorTier) {
    jobMats[jobName].push(jobMatTypes['job'] + '\'s Memory (' + colorTier + ')');
  });

  weaponTierNames.forEach(function (weaponTier) {
    jobMats[jobName].push(jobMatTypes['weapon'] + ' ' + weaponTier);
  });
}

var rawCsv = "1:1:1 Twin Princes,Faint Memory (Green),Sword Jadeite,Bow Jadeite,Earth Alcryst (Green),Ranger's Memory (Green),Warrior's Memory (Green),Praying Angel Statue (Green),Sorrowful Heart,Murky Fluid,\n" +
  "1:1:2 Premonition of Blood and Ruin,Faint Memory (Green),Greatsword Jadeite,Gun Jadeite,Ice Alcryst (Green),Knight's Memory (Green),Gunner's Memory (Green),Prowling Wyvern Statue (Green),Grey Spiritsand,Murky Fluid,\n" +
  "1:1:3 United Front,Faint Memory (Green),Katana Jadeite,Staff Jadeite,Wind Alcryst (Green),Paladin's Memory (Green),White Mage's Memory (Green),Praying Angel Statue (Green),Sorrowful Heart,Murky Fluid,\n" +
  "1:1:4 Do As the Lions Do,Faint Memory (Green),Fists Jadeite,Mace Jadeite,Axe Jadeite,Fire Alcryst (Green),Soldier's Memory (Green),Black Mage's Memory (Green),Prowling Wyvern Statue (Green),Grey Spiritsand,Cloudy Sap,Longsword Crafting Recipe\n" +
  "1:1:5 Proof of Trust,Faint Memory (Green),Sword Jadeite,Spear Jadeite,Lightning Alcryst (Green),Monk's Memory (Green),Red Mage's Memory (Green),Praying Angel Statue (Green),Sorrowful Heart,Murky Fluid,Claymore Crafting Recipe\n" +
  "1:1:6 Amongst the Ruins,Faint Memory (Green),Greatsword Jadeite,Dagger Jadeite,Water Alcryst (Green),Samurai's Memory (Green),Green Mage's Memory (Green),Viking's Memory (Green),Prowling Wyvern Statue (Green),Sorrowful Heart,Murky Fluid,Kotetsu Crafting Recipe\n" +
  "1:1:7 Show Me Strength,Faint Memory (Green),Katana Jadeite,Ninja Blade Jadeite,Light Alcryst (Green),Lancer's Memory (Green),Time Mage's Memory (Green),Praying Angel Statue (Green),Sorrowful Heart,Murky Fluid,Metal Knuckles Crafting Recipe\n" +
  "1:1:8 Ancient Relic,Faint Memory (Green),Fists Jadeite,Bow Jadeite,Axe Jadeite,Dark Alcryst (Green),Dragoon's Memory (Green),Spellblade's Memory (Green),Prowling Wyvern Statue (Green),Sorrowful Heart,Cloudy Sap,Long Bow Crafting Recipe\n" +
  "1:1:9 The Way of Hourne,Faint Memory (Green),Spear Jadeite,Gun Jadeite,Earth Alcryst (Green),Thief's Memory (Green),Cleric's Memory (Green),Praying Angel Statue (Green),Grey Spiritsand,Murky Fluid,Capella Crafting Recipe,Ogrekiller Crafting Recipe\n" +
  "1:1:10 Prove Your Worth,Faint Memory (Green),Dagger Jadeite,Staff Jadeite,Ice Alcryst (Green),Ninja's Memory (Green),Winged One's Memory (Green),Warrior's Memory (Green),Prowling Wyvern Statue (Green),Grey Spiritsand,Murky Fluid,Iron Rod Crafting Recipe\n" +
  "1:2:1 To the Lion's Den,Faint Memory (Green),Ninja Blade Jadeite,Mace Jadeite,Wind Alcryst (Green),Ranger's Memory (Green),Knight's Memory (Green),Praying Angel Statue (Green),Sorrowful Heart,Cloudy Sap,Iron Mace Crafting Recipe\n" +
  "1:2:2 The Savage King's Daughter,Faint Memory (Green),Sword Jadeite,Bow Jadeite,Fire Alcryst (Green),Gunner's Memory (Green),Paladin's Memory (Green),Prowling Wyvern Statue (Green),Sorrowful Heart,Murky Fluid,Iron Plate Crafting Recipe\n" +
  "1:2:3 All the Happiness in the World,Faint Memory (Green),Greatsword Jadeite,Gun Jadeite,Lightning Alcryst (Green),Soldier's Memory (Green),White Mage's Memory (Green),Praying Angel Statue (Green),Sorrowful Heart,Cloudy Sap,Partisan Crafting Recipe\n" +
  "1:2:4 Afoul of the Gods,Faint Memory (Green),Katana Jadeite,Staff Jadeite,Water Alcryst (Green),Black Mage's Memory (Green),Monk's Memory (Green),Prowling Wyvern Statue (Green),Grey Spiritsand,Murky Fluid,Dagger Crafting Recipe\n" +
  "1:2:5 Volition,Faint Memory (Green),Fists Jadeite,Mace Jadeite,Axe Jadeite,Light Alcryst (Green),Red Mage's Memory (Green),Samurai's Memory (Green),Viking's Memory (Green),Praying Angel Statue (Green),Murky Fluid,Cloudy Sap,Iron Helm Crafting Recipe\n" +
  "1:2:6 What You Should Fear,Faint Memory (Green),Sword Jadeite,Spear Jadeite,Dark Alcryst (Green),Green Mage's Memory (Green),Lancer's Memory (Green),Prowling Wyvern Statue (Green),Grey Spiritsand,Sorrowful Heart,Hero's Ring Crafting Recipe\n" +
  "1:2:7 Wavering Spirit,Faint Memory (Green),Greatsword Jadeite,Dagger Jadeite,Earth Alcryst (Green),Time Mage's Memory (Green),Dragoon's Memory (Green),Praying Angel Statue (Green),Sorrowful Heart,Murky Fluid,Longsword Crafting Recipe\n" +
  "1:2:8 Radiant Light,Faint Memory (Green),Katana Jadeite,Ninja Blade Jadeite,Axe Jadeite,Ice Alcryst (Green),Spellblade's Memory (Green),Thief's Memory (Green),Prowling Wyvern Statue (Green),Murky Fluid,Cloudy Sap,Claymore Crafting Recipe\n" +
  "1:2:9 Never-Ending Battle,Faint Memory (Green),Fists Jadeite,Bow Jadeite,Wind Alcryst (Green),Cleric's Memory (Green),Ninja's Memory (Green),Praying Angel Statue (Green),Grey Spiritsand,Sorrowful Heart,Kotetsu Crafting Recipe\n" +
  "1:2:10 Redemption,Faint Memory (Green),Spear Jadeite,Gun Jadeite,Fire Alcryst (Green),Ranger's Memory (Green),Winged One's Memory (Green),Warrior's Memory (Green),Prowling Wyvern Statue (Green),Murky Fluid,Cloudy Sap,Metal Knuckles Crafting Recipe,Ogrekiller Crafting Recipe\n" +
  "1:3:1 Concerns,Faint Memory (Blue),Sword Azurite,Bow Azurite,Lightning Alcryst (Blue),Ranger's Memory (Blue),Warrior's Memory (Blue),Praying Angel Statue (Blue),Sorrowful Heart,Murky Fluid,Partisan Crafting Recipe\n" +
  "1:3:2 Shadows in the Ruins,Faint Memory (Blue),Greatsword Azurite,Gun Azurite,Water Alcryst (Blue),Knight's Memory (Blue),Gunner's Memory (Blue),Prowling Wyvern Statue (Blue),Grey Spiritsand,Murky Fluid,Dagger Crafting Recipe\n" +
  "1:3:3 False Accusations,Faint Memory (Blue),Katana Azurite,Staff Azurite,Light Alcryst (Blue),Paladin's Memory (Blue),White Mage's Memory (Blue),Praying Angel Statue (Blue),Murky Fluid,Cloudy Sap,Kunai Crafting Recipe\n" +
  "1:3:4 Road to Ruin I,Faint Memory (Blue),Fists Azurite,Mace Azurite,Dark Alcryst (Blue),Soldier's Memory (Blue),Black Mage's Memory (Blue),Prowling Wyvern Statue (Blue),Grey Spiritsand,Murky Fluid,Long Bow Crafting Recipe\n" +
  "1:3:5 Road to Ruin II,Faint Memory (Blue),Sword Azurite,Spear Azurite,Earth Alcryst (Blue),Monk's Memory (Blue),Red Mage's Memory (Blue),Viking's Memory (Blue),Praying Angel Statue (Blue),Grey Spiritsand,Cloudy Sap,Capella Crafting Recipe\n" +
  "1:3:6 Boisterous Stars,Faint Memory (Blue),Greatsword Azurite,Dagger Azurite,Ice Alcryst (Blue),Samurai's Memory (Blue),Green Mage's Memory (Blue),Prowling Wyvern Statue (Blue),Sorrowful Heart,Murky Fluid,Iron Rod Crafting Recipe\n" +
  "1:3:7 What Has Been Lost,Faint Memory (Blue),Katana Azurite,Ninja Blade Azurite,Wind Alcryst (Blue),Lancer's Memory (Blue),Time Mage's Memory (Blue),Praying Angel Statue (Blue),Sorrowful Heart,Murky Fluid,Iron Mace Crafting Recipe\n" +
  "1:3:8 To Keep One Person Safe,Faint Memory (Blue),Fists Azurite,Bow Azurite,Axe Azurite,Fire Alcryst (Blue),Dragoon's Memory (Blue),Spellblade's Memory (Blue),Prowling Wyvern Statue (Blue),Murky Fluid,Cloudy Sap,Iron Plate Crafting Recipe\n" +
  "1:3:10 Reinforcements,Faint Memory (Blue),Spear Azurite,Gun Azurite,Axe Azurite,Lightning Alcryst (Blue),Thief's Memory (Blue),Cleric's Memory (Blue),Prowling Wyvern Statue (Blue),Grey Spiritsand,Sorrowful Heart,Wizard's Hat Crafting Recipe\n" +
  "2:1:1 «Fortem» Move Out I,Faint Memory (Blue),Dagger Azurite,Staff Azurite,Water Alcryst (Blue),Ninja's Memory (Blue),Winged One's Memory (Blue),Warrior's Memory (Blue),Praying Angel Statue (Blue),Grey Spiritsand,Sorrowful Heart,Scholar Robe Crafting Recipe\n" +
  "2:1:2 «Fortem» Move Out II,Faint Memory (Blue),Sword Azurite,Ninja Blade Azurite,Light Alcryst (Blue),Knight's Memory (Blue),Gunner's Memory (Blue),Prowling Wyvern Statue (Blue),Grey Spiritsand,Murky Fluid,Iron Helm Crafting Recipe\n" +
  "2:1:3 What It Takes to Be a Prince,Faint Memory (Blue),Greatsword Azurite,Bow Azurite,Axe Azurite,Dark Alcryst (Blue),Paladin's Memory (Blue),White Mage's Memory (Blue),Praying Angel Statue (Blue),Sorrowful Heart,Cloudy Sap,Hero's Ring Crafting Recipe,Ogrekiller Crafting Recipe\n" +
  "2:1:4 The Successor,Faint Memory (Blue),Katana Azurite,Gun Azurite,Earth Alcryst (Blue),Soldier's Memory (Blue),Black Mage's Memory (Blue),Prowling Wyvern Statue (Blue),Grey Spiritsand,Cloudy Sap,Longsword Crafting Recipe\n" +
  "2:1:5 Bloom I,Faint Memory (Blue),Fists Azurite,Staff Azurite,Ice Alcryst (Blue),Monk's Memory (Blue),Red Mage's Memory (Blue),Viking's Memory (Blue),Praying Angel Statue (Blue),Grey Spiritsand,Sorrowful Heart,Claymore Crafting Recipe\n" +
  "2:1:6 Bloom II,Faint Memory (Blue),Spear Azurite,Mace Azurite,Wind Alcryst (Blue),Samurai's Memory (Blue),Green Mage's Memory (Blue),Prowling Wyvern Statue (Blue),Sorrowful Heart,Murky Fluid,Kotetsu Crafting Recipe\n" +
  "2:1:7 Continuing Attack,Faint Memory (Blue),Sword Azurite,Dagger Azurite,Fire Alcryst (Blue),Lancer's Memory (Blue),Time Mage's Memory (Blue),Praying Angel Statue (Blue),Sorrowful Heart,Murky Fluid,Metal Knuckles Crafting Recipe\n" +
  "2:1:8 You Should As Well,Faint Memory (Blue),Greatsword Azurite,Ninja Blade Azurite,Lightning Alcryst (Blue),Dragoon's Memory (Blue),Spellblade's Memory (Blue),Prowling Wyvern Statue (Blue),Grey Spiritsand,Cloudy Sap,Partisan Crafting Recipe\n" +
  "2:1:9 «Fortem» Has Arrived,Faint Memory (Blue),Katana Azurite,Bow Azurite,Water Alcryst (Blue),Thief's Memory (Blue),Cleric's Memory (Blue),Praying Angel Statue (Blue),Grey Spiritsand,Murky Fluid,Dagger Crafting Recipe\n" +
  "2:1:10 What the Stars Say,Faint Memory (Blue),Fists Azurite,Gun Azurite,Axe Azurite,Light Alcryst (Blue),Ninja's Memory (Blue),Winged One's Memory (Blue),Warrior's Memory (Blue),Prowling Wyvern Statue (Blue),Grey Spiritsand,Murky Fluid,Kunai Crafting Recipe\n" +
  "2:2:1 A Fighting Retreat I,Faint Memory (Blue),Spear Azurite,Staff Azurite,Dark Alcryst (Blue),Ranger's Memory (Blue),Knight's Memory (Blue),Praying Angel Statue (Blue),Grey Spiritsand,Sorrowful Heart,Long Bow Crafting Recipe\n" +
  "2:2:2 Message,Faint Memory (Blue),Dagger Azurite,Mace Azurite,Earth Alcryst (Blue),Ranger's Memory (Blue),Gunner's Memory (Blue),Prowling Wyvern Statue (Blue),Murky Fluid,Cloudy Sap,Capella Crafting Recipe\n" +
  "2:2:3 A Fighting Retreat II,Faint Memory (Blue),Sword Azurite,Ninja Blade Azurite,Ice Alcryst (Blue),Paladin's Memory (Blue),White Mage's Memory (Blue),Praying Angel Statue (Blue),Grey Spiritsand,Cloudy Sap,Iron Rod Crafting Recipe\n" +
  "2:2:4 I Would Shed a Tear,Faint Memory (Blue),Greatsword Azurite,Bow Azurite,Wind Alcryst (Blue),Soldier's Memory (Blue),Black Mage's Memory (Blue),Prowling Wyvern Statue (Blue),Grey Spiritsand,Murky Fluid,Iron Mace Crafting Recipe,Ogrekiller Crafting Recipe\n" +
  "2:2:5 Duty As a Guardian,Faint Memory (Blue),Katana Azurite,Gun Azurite,Fire Alcryst (Blue),Monk's Memory (Blue),Red Mage's Memory (Blue),Viking's Memory (Blue),Praying Angel Statue (Blue),Sorrowful Heart,Cloudy Sap,Iron Plate Crafting Recipe\n" +
  "2:2:6 Silent Lion's Den,Faint Memory (Blue),Fists Azurite,Staff Azurite,Lightning Alcryst (Blue),Samurai's Memory (Blue),Green Mage's Memory (Blue),Prowling Wyvern Statue (Blue),Sorrowful Heart,Cloudy Sap,Wizard's Hat Crafting Recipe\n" +
  "2:2:7 Two Shinobi,Faint Memory (Blue),Spear Azurite,Mace Azurite,Axe Azurite,Water Alcryst (Blue),Lancer's Memory (Blue),Time Mage's Memory (Blue),Praying Angel Statue (Blue),Grey Spiritsand,Murky Fluid,Scholar Robe Crafting Recipe\n" +
  "2:2:8 The Royal Bloodline,Faint Memory (Blue),Sword Azurite,Dagger Azurite,Light Alcryst (Blue),Dragoon's Memory (Blue),Spellblade's Memory (Blue),Prowling Wyvern Statue (Blue),Murky Fluid,Cloudy Sap,Iron Helm Crafting Recipe\n" +
  "2:2:9 Return of the Prince,Faint Memory (Blue),Greatsword Azurite,Ninja Blade Azurite,Dark Alcryst (Blue),Thief's Memory (Blue),Cleric's Memory (Blue),Praying Angel Statue (Blue),Grey Spiritsand,Sorrowful Heart,Hero's Ring Crafting Recipe\n" +
  "2:2:10 Pride of the Lions,Faint Memory (Blue),Katana Azurite,Bow Azurite,Earth Alcryst (Blue),Ninja's Memory (Blue),Winged One's Memory (Blue),Warrior's Memory (Blue),Prowling Wyvern Statue (Blue),Murky Fluid,Cloudy Sap,Longsword Crafting Recipe\n" +
  "2:3:1 Godess's Revelation,Faint Memory (Purple),Sword Charoite,Fists Charoite,Ice Alcryst (Purple),Ranger's Memory (Purple),Knight's Memory (Purple),Praying Angel Statue (Purple),Grey Spiritsand,Sorrowful Heart,Claymore Crafting Recipe\n" +
  "2:3:2 Before I Forget  You,Faint Memory (Purple),Greatsword Charoite,Spear Charoite,Wind Alcryst (Purple),Gunner's Memory (Purple),Paladin's Memory (Purple),Prowling Wyvern Statue (Purple),Murky Fluid,Cloudy Sap,Kotetsu Crafting Recipe\n" +
  "2:3:3 For the Sake of the Bloodline,Faint Memory (Purple),Katana Charoite,Dagger Charoite,Fire Alcryst (Purple),Soldier's Memory (Purple),White Mage's Memory (Purple),Praying Angel Statue (Purple),Sorrowful Heart,Cloudy Sap,Metal Knuckles Crafting Recipe\n" +
  "2:3:4 Master's Spirit,Faint Memory (Purple),Fists Charoite,Ninja Blade Charoite,Axe Charoite,Lightning Alcryst (Purple),Black Mage's Memory (Purple),Monk's Memory (Purple),Prowling Wyvern Statue (Purple),Grey Spiritsand,Cloudy Sap,Partisan Crafting Recipe\n" +
  "2:3:5 Return the Favor,Faint Memory (Purple),Spear Charoite,Bow Charoite,Water Alcryst (Purple),Red Mage's Memory (Purple),Samurai's Memory (Purple),Viking's Memory (Purple),Praying Angel Statue (Purple),Grey Spiritsand,Murky Fluid,Dagger Crafting Recipe\n" +
  "2:3:6 On the Run,Faint Memory (Purple),Dagger Charoite,Gun Charoite,Light Alcryst (Purple),Green Mage's Memory (Purple),Lancer's Memory (Purple),Prowling Wyvern Statue (Purple),Sorrowful Heart,Murky Fluid,Kunai Crafting Recipe\n" +
  "2:3:7 The Bull and the Viper,Faint Memory (Purple),Staff Charoite,Ninja Blade Charoite,Dark Alcryst (Purple),Time Mage's Memory (Purple),Dragoon's Memory (Purple),Praying Angel Statue (Purple),Sorrowful Heart,Murky Fluid,Long Bow Crafting Recipe\n" +
  "2:3:8 Threat to the West,Faint Memory (Purple),Bow Charoite,Mace Charoite,Earth Alcryst (Purple),Spellblade's Memory (Purple),Thief's Memory (Purple),Prowling Wyvern Statue (Purple),Grey Spiritsand,Cloudy Sap,Capella Crafting Recipe\n" +
  "2:3:9 Enclosing Plots,Faint Memory (Purple),Sword Charoite,Gun Charoite,Ice Alcryst (Purple),Cleric's Memory (Purple),Ninja's Memory (Purple),Praying Angel Statue (Purple),Grey Spiritsand,Murky Fluid,Iron Rod Crafting Recipe\n" +
  "2:3:10 First Sword,Faint Memory (Purple),Greatsword Charoite,Staff Charoite,Axe Charoite,Wind Alcryst (Purple),Ranger's Memory (Purple),Monk's Memory (Purple),Winged One's Memory (Purple),Prowling Wyvern Statue (Purple),Murky Fluid,Cloudy Sap,Iron Mace Crafting Recipe,Ogrekiller Crafting Recipe\n" +
  "3:1:1 Creeping Despair,Faint Memory (Purple),Katana Charoite,Mace Charoite,Fire Alcryst (Purple),Gunner's Memory (Purple),Warrior's Memory (Purple),Praying Angel Statue (Purple),Grey Spiritsand,Sorrowful Heart,Iron Plate Crafting Recipe\n" +
  "3:1:2 Withering Hope,Faint Memory (Purple),Sword Charoite,Fists Charoite,Lightning Alcryst (Purple),Knight's Memory (Purple),White Mage's Memory (Purple),Prowling Wyvern Statue (Purple),Murky Fluid,Cloudy Sap,Wizard's Hat Crafting Recipe\n" +
  "3:1:3 The Church's Aim I,Faint Memory (Purple),Greatsword Charoite,Spear Charoite,Axe Charoite,Water Alcryst (Purple),Paladin's Memory (Purple),Black Mage's Memory (Purple),Praying Angel Statue (Purple),Grey Spiritsand,Cloudy Sap,Scholar Robe Crafting Recipe\n" +
  "3:1:4 The Church's Aim II,Faint Memory (Purple),Katana Charoite,Dagger Charoite,Light Alcryst (Purple),Soldier's Memory (Purple),Red Mage's Memory (Purple),Prowling Wyvern Statue (Purple),Grey Spiritsand,Murky Fluid,Iron Helm Crafting Recipe\n" +
  "3:1:5 The True State of Wezette I,Faint Memory (Purple),Fists Charoite,Ninja Blade Charoite,Dark Alcryst (Purple),Monk's Memory (Purple),Green Mage's Memory (Purple),Viking's Memory (Purple),Praying Angel Statue (Purple),Sorrowful Heart,Murky Fluid,Hero's Ring Crafting Recipe\n" +
  "3:1:6 The True State of Wezette II,Faint Memory (Purple),Spear Charoite,Bow Charoite,Earth Alcryst (Purple),Samurai's Memory (Purple),Time Mage's Memory (Purple),Prowling Wyvern Statue (Purple),Sorrowful Heart,Cloudy Sap,Longsword Crafting Recipe\n" +
  "3:1:7 Remote Village,Faint Memory (Purple),Dagger Charoite,Gun Charoite,Ice Alcryst (Purple),Lancer's Memory (Purple),Spellblade's Memory (Purple),Praying Angel Statue (Purple),Grey Spiritsand,Murky Fluid,Claymore Crafting Recipe\n" +
  "3:1:8 Defiance,Faint Memory (Purple),Staff Charoite,Ninja Blade Charoite,Wind Alcryst (Purple),Dragoon's Memory (Purple),Cleric's Memory (Purple),Prowling Wyvern Statue (Purple),Murky Fluid,Cloudy Sap,Kotetsu Crafting Recipe\n" +
  "3:1:9 Rebellion and Suppression,Faint Memory (Purple),Bow Charoite,Mace Charoite,Fire Alcryst (Purple),Thief's Memory (Purple),Warrior's Memory (Purple),Praying Angel Statue (Purple),Grey Spiritsand,Sorrowful Heart,Metal Knuckles Crafting Recipe\n" +
  "3:1:10 Pay with Your Life,Faint Memory (Purple),Sword Charoite,Gun Charoite,Axe Charoite,Lightning Alcryst (Purple),Knight's Memory (Purple),Ninja's Memory (Purple),Winged One's Memory (Purple),Prowling Wyvern Statue (Purple),Murky Fluid,Cloudy Sap,Partisan Crafting Recipe\n" +
  "3:2:1 Mastermind,Faint Memory (Purple),Greatsword Charoite,Staff Charoite,Water Alcryst (Purple),Ranger's Memory (Purple),Paladin's Memory (Purple),Praying Angel Statue (Purple),Grey Spiritsand,Sorrowful Heart,Dagger Crafting Recipe\n" +
  "3:2:2 Allow Me,Faint Memory (Purple),Katana Charoite,Mace Charoite,Light Alcryst (Purple),Gunner's Memory (Purple),Soldier's Memory (Purple),Prowling Wyvern Statue (Purple),Murky Fluid,Cloudy Sap,Kunai Crafting Recipe\n" +
  "3:2:3 No Need for Mercy I,Faint Memory (Purple),Sword Charoite,Fists Charoite,Dark Alcryst (Purple),White Mage's Memory (Purple),Monk's Memory (Purple),Praying Angel Statue (Purple),Sorrowful Heart,Cloudy Sap,Long Bow Crafting Recipe\n" +
  "3:2:4 No Need for Mercy II,Faint Memory (Purple),Greatsword Charoite,Spear Charoite,Earth Alcryst (Purple),Black Mage's Memory (Purple),Samurai's Memory (Purple),Prowling Wyvern Statue (Purple),Grey Spiritsand,Cloudy Sap,Capella Crafting Recipe\n" +
  "3:2:5 Minwu the Villager,Faint Memory (Purple),Katana Charoite,Dagger Charoite,Ice Alcryst (Purple),Red Mage's Memory (Purple),Lancer's Memory (Purple),Viking's Memory (Purple),Praying Angel Statue (Purple),Sorrowful Heart,Murky Fluid,Iron Rod Crafting Recipe\n" +
  "3:2:6 Keep the Coin,Faint Memory (Purple),Fists Charoite,Ninja Blade Charoite,Wind Alcryst (Purple),Green Mage's Memory (Purple),Dragoon's Memory (Purple),Prowling Wyvern Statue (Purple),Sorrowful Heart,Murky Fluid,Iron Mace Crafting Recipe,Ogrekiller Crafting Recipe\n" +
  "3:2:7 Leave the Village,Faint Memory (Purple),Spear Charoite,Bow Charoite,Axe Charoite,Fire Alcryst (Purple),Time Mage's Memory (Purple),Thief's Memory (Purple),Praying Angel Statue (Purple),Sorrowful Heart,Murky Fluid,Iron Plate Crafting Recipe\n" +
  "3:2:8 A Gift,Faint Memory (Purple),Dagger Charoite,Gun Charoite,Lightning Alcryst (Purple),Spellblade's Memory (Purple),Ninja's Memory (Purple),Prowling Wyvern Statue (Purple),Grey Spiritsand,Cloudy Sap,Wizard's Hat Crafting Recipe\n" +
  "3:2:9 Radiance of Destruction,Faint Memory (Purple),Staff Charoite,Ninja Blade Charoite,Water Alcryst (Purple),Ranger's Memory (Purple),Cleric's Memory (Purple),Praying Angel Statue (Purple),Grey Spiritsand,Sorrowful Heart,Scholar Robe Crafting Recipe\n" +
  "3:2:10 Uncertainty,Faint Memory (Purple),Bow Charoite,Mace Charoite,Light Alcryst (Purple),Gunner's Memory (Purple),Dragoon's Memory (Purple),Winged One's Memory (Purple),Prowling Wyvern Statue (Purple),Murky Fluid,Cloudy Sap,Iron Helm Crafting Recipe\n" +
  "3:3:1 «Nitor» Move Out,Faint Memory (Purple),Sword Charoite,Gun Charoite,Dark Alcryst (Purple),White Mage's Memory (Purple),Warrior's Memory (Purple),Praying Angel Statue (Purple),Grey Spiritsand,Sorrowful Heart,Hero's Ring Crafting Recipe\n" +
  "3:3:2 True Intentions,Faint Memory (Purple),Greatsword Charoite,Staff Charoite,Earth Alcryst (Purple),Knight's Memory (Purple),Black Mage's Memory (Purple),Prowling Wyvern Statue (Purple),Murky Fluid,Cloudy Sap,Longsword Crafting Recipe\n" +
  "3:3:3 Growing Mistrust,Faint Memory (Purple),Katana Charoite,Mace Charoite,Axe Charoite,Ice Alcryst (Purple),Paladin's Memory (Purple),Red Mage's Memory (Purple),Praying Angel Statue (Purple),Grey Spiritsand,Cloudy Sap,Claymore Crafting Recipe\n" +
  "3:3:4 Road to Wezette,Faint Memory (Purple),Sword Charoite,Fists Charoite,Wind Alcryst (Purple),Soldier's Memory (Purple),Green Mage's Memory (Purple),Prowling Wyvern Statue (Purple),Grey Spiritsand,Murky Fluid,Kotetsu Crafting Recipe\n" +
  "3:3:5 Muraga's Prey,Faint Memory (Purple),Greatsword Charoite,Spear Charoite,Earth Alcryst (Purple),Monk's Memory (Purple),Time Mage's Memory (Purple),Viking's Memory (Purple),Praying Angel Statue (Purple),Sorrowful Heart,Murky Fluid,Metal Knuckles Crafting Recipe\n" +
  "3:3:6 Reckless Brothers I,Faint Memory (Purple),Katana Charoite,Dagger Charoite,Lightning Alcryst (Purple),Samurai's Memory (Purple),Spellblade's Memory (Purple),Prowling Wyvern Statue (Purple),Sorrowful Heart,Cloudy Sap,Partisan Crafting Recipe\n" +
  "3:3:7 Reckless Brothers II,Faint Memory (Purple),Fists Charoite,Ninja Blade Charoite,Water Alcryst (Purple),Lancer's Memory (Purple),Cleric's Memory (Purple),Praying Angel Statue (Purple),Grey Spiritsand,Murky Fluid,Dagger Crafting Recipe\n" +
  "3:3:8 Unforgettable,Faint Memory (Purple),Spear Charoite,Bow Charoite,Light Alcryst (Purple),Dragoon's Memory (Purple),Warrior's Memory (Purple),Prowling Wyvern Statue (Purple),Murky Fluid,Cloudy Sap,Kunai Crafting Recipe\n" +
  "3:3:9 Reasons,Faint Memory (Purple),Dagger Charoite,Gun Charoite,Dark Alcryst (Purple),Knight's Memory (Purple),Thief's Memory (Purple),Praying Angel Statue (Purple),Grey Spiritsand,Sorrowful Heart,Long Bow Crafting Recipe\n" +
  "3:3:10 The Queen's Plan,Faint Memory (Purple),Staff Charoite,Ninja Blade Charoite,Axe Charoite,Ice Alcryst (Purple),Paladin's Memory (Purple),Ninja's Memory (Purple),Winged One's Memory (Purple),Prowling Wyvern Statue (Purple),Sorrowful Heart,Cloudy Sap,Capella Crafting Recipe\n" +
  "4:1:1 Premonition,Faint Memory (Purple),Bow Charoite,Mace Charoite,Fire Alcryst (Purple),Ranger's Memory (Purple),Soldier's Memory (Purple),Praying Angel Statue (Purple),Blue Spiritsand,Raging Heart,Mythril Sword Crafting Recipe\n" +
  "4:1:2 Swelling Doubts,Faint Memory (Purple),Sword Charoite,Gun Charoite,Wind Alcryst (Purple),Gunner's Memory (Purple),Monk's Memory (Purple),Prowling Wyvern Statue (Purple),Sticky Fluid,Clear Sap,Mythril Saber Crafting Recipe\n" +
  "4:1:3 Abandon the Cave,Faint Memory (Purple),Greatsword Charoite,Staff Charoite,Water Alcryst (Purple),White Mage's Memory (Purple),Samurai's Memory (Purple),Praying Angel Statue (Purple),Blue Spiritsand,Clear Sap,Kiku-ichimonji Crafting Recipe\n" +
  "4:1:4 To Anvil Castle I,Faint Memory (Purple),Katana Charoite,Mace Charoite,Lightning Alcryst (Purple),Black Mage's Memory (Purple),Lancer's Memory (Purple),Viking's Memory (Purple),Prowling Wyvern Statue (Purple),Blue Spiritsand,Sticky Fluid,Mythril Claws Crafting Recipe,Mythril Axe Crafting Recipe\n" +
  "4:1:5 To Anvil Castle II,Faint Memory (Purple),Sword Charoite,Fists Charoite,Axe Charoite,Fire Alcryst (Purple),Red Mage's Memory (Purple),Dragoon's Memory (Purple),Praying Angel Statue (Purple),Raging Heart,Sticky Fluid,Mythril Spear Crafting Recipe\n" +
  "4:1:6 Perilous Road I,Faint Memory (Purple),Greatsword Charoite,Spear Charoite,Light Alcryst (Purple),Green Mage's Memory (Purple),Thief's Memory (Purple),Prowling Wyvern Statue (Purple),Raging Heart,Clear Sap,Mythril Dagger Crafting Recipe\n" +
  "4:1:7 Perilous Road II,Faint Memory (Purple),Katana Charoite,Dagger Charoite,Dark Alcryst (Purple),Time Mage's Memory (Purple),Ninja's Memory (Purple),Praying Angel Statue (Purple),Blue Spiritsand,Sticky Fluid,Kodachi Crafting Recipe\n" +
  "4:1:8 For Leonis!,Faint Memory (Purple),Fists Charoite,Ninja Blade Charoite,Axe Charoite,Earth Alcryst (Purple),Ranger's Memory (Purple),Spellblade's Memory (Purple),Prowling Wyvern Statue (Purple),Sticky Fluid,Clear Sap,Great Bow Crafting Recipe\n" +
  "4:1:9 A Peculiar Sign,Faint Memory (Purple),Spear Charoite,Bow Charoite,Ice Alcryst (Purple),Gunner's Memory (Purple),Cleric's Memory (Purple),Praying Angel Statue (Purple),Blue Spiritsand,Raging Heart,Vega Crafting Recipe\n" +
  "4:1:10 Four Stone Chests,Faint Memory (Purple),Dagger Charoite,Gun Charoite,Water Alcryst (Purple),White Mage's Memory (Purple),Samurai's Memory (Purple),Winged One's Memory (Purple),Prowling Wyvern Statue (Purple),Raging Heart,Clear Sap,Platinum Rod Crafting Recipe\n" +
  "4:2:1 Shinobi of Fennes,Faint Memory (Purple),Staff Charoite,Ninja Blade Charoite,Fire Alcryst (Purple),Black Mage's Memory (Purple),Warrior's Memory (Purple),Praying Angel Statue (Purple),Blue Spiritsand,Raging Heart,Mythril Mace Crafting Recipe\n" +
  "4:2:2 Mere Sham,Faint Memory (Purple),Bow Charoite,Mace Charoite,Dark Alcryst (Purple),Knight's Memory (Purple),Red Mage's Memory (Purple),Prowling Wyvern Statue (Purple),Sticky Fluid,Clear Sap,Mythril Armor Crafting Recipe\n" +
  "4:2:3 Break Through I,Faint Memory (Purple),Sword Charoite,Gun Charoite,Wind Alcryst (Purple),Paladin's Memory (Purple),Green Mage's Memory (Purple),Praying Angel Statue (Purple),Raging Heart,Clear Sap,Circlet Crafting Recipe\n" +
  "4:2:4 Break Through II,Faint Memory (Purple),Greatsword Charoite,Staff Charoite,Light Alcryst (Purple),Soldier's Memory (Purple),Time Mage's Memory (Purple),Prowling Wyvern Statue (Purple),Blue Spiritsand,Clear Sap,Mirage Vest Crafting Recipe\n" +
  "4:2:5 Sir Owe I,Faint Memory (Purple),Katana Charoite,Mace Charoite,Lightning Alcryst (Purple),Monk's Memory (Purple),Spellblade's Memory (Purple),Viking's Memory (Purple),Praying Angel Statue (Purple),Blue Spiritsand,Sticky Fluid,Mythril Helm Crafting Recipe\n" +
  "4:2:6 Sir Owe II,Faint Memory (Purple),Sword Charoite,Fists Charoite,Earth Alcryst (Purple),Samurai's Memory (Purple),Cleric's Memory (Purple),Prowling Wyvern Statue (Purple),Raging Heart,Sticky Fluid,Fairy Ring Crafting Recipe\n" +
  "4:2:7 A Dance of Blades and Blood,Faint Memory (Purple),Greatsword Charoite,Spear Charoite,Axe Charoite,Ice Alcryst (Purple),Lancer's Memory (Purple),Warrior's Memory (Purple),Praying Angel Statue (Purple),Raging Heart,Sticky Fluid,Mythril Sword Crafting Recipe\n" +
  "4:2:8 Scumbags Pay Their Respects,Faint Memory (Purple),Katana Charoite,Dagger Charoite,Wind Alcryst (Purple),Knight's Memory (Purple),Dragoon's Memory (Purple),Prowling Wyvern Statue (Purple),Blue Spiritsand,Clear Sap,Mythril Saber Crafting Recipe\n" +
  "4:2:9 Good Idea,Faint Memory (Purple),Fists Charoite,Ninja Blade Charoite,Fire Alcryst (Purple),Paladin's Memory (Purple),Thief's Memory (Purple),Praying Angel Statue (Purple),Blue Spiritsand,Raging Heart,Kiku-ichimonji Crafting Recipe\n" +
  "4:2:10 Enough to Kill,Faint Memory (Purple),Spear Charoite,Bow Charoite,Lightning Alcryst (Purple),Ninja's Memory (Purple),Winged One's Memory (Purple),Warrior's Memory (Purple),Prowling Wyvern Statue (Purple),Blue Spiritsand,Sticky Fluid,Mythril Claws Crafting Recipe,Mythril Axe Crafting Recipe\n" +
  "4:3:1 Dawn at Hand,Faint Memory (Yellow),Sword Citrine,Spear Citrine,Water Alcryst (Yellow),Ranger's Memory (Yellow),Knight's Memory (Yellow),Praying Angel Statue (Yellow),Raging Heart,Sticky Fluid,Mythril Spear Crafting Recipe\n" +
  "4:3:2 At Wit's End,Faint Memory (Yellow),Greatsword Citrine,Dagger Citrine,Light Alcryst (Yellow),Gunner's Memory (Yellow),Paladin's Memory (Yellow),Prowling Wyvern Statue (Yellow),Sticky Fluid,Clear Sap,Mythril Dagger Crafting Recipe\n" +
  "4:3:3 Two Paths,Faint Memory (Yellow),Katana Citrine,Ninja Blade Citrine,Dark Alcryst (Yellow),Soldier's Memory (Yellow),White Mage's Memory (Yellow),Praying Angel Statue (Yellow),Blue Spiritsand,Clear Sap,Kodachi Crafting Recipe\n" +
  "4:3:4 Three Stone Chests,Faint Memory (Yellow),Fists Citrine,Bow Citrine,Axe Citrine,Earth Alcryst (Yellow),Black Mage's Memory (Yellow),Monk's Memory (Yellow),Prowling Wyvern Statue (Yellow),Blue Spiritsand,Sticky Fluid,Great Bow Crafting Recipe\n" +
  "4:3:5 Survive! I,Faint Memory (Yellow),Spear Citrine,Gun Citrine,Wind Alcryst (Yellow),Red Mage's Memory (Yellow),Samurai's Memory (Yellow),Viking's Memory (Yellow),Praying Angel Statue (Yellow),Raging Heart,Sticky Fluid,Vega Crafting Recipe\n" +
  "4:3:6 Head North,Faint Memory (Yellow),Dagger Citrine,Staff Citrine,Ice Alcryst (Yellow),Green Mage's Memory (Yellow),Lancer's Memory (Yellow),Prowling Wyvern Statue (Yellow),Raging Heart,Clear Sap,Platinum Rod Crafting Recipe\n" +
  "4:3:7 Survive! II,Faint Memory (Yellow),Ninja Blade Citrine,Mace Citrine,Fire Alcryst (Yellow),Time Mage's Memory (Yellow),Dragoon's Memory (Yellow),Praying Angel Statue (Yellow),Blue Spiritsand,Sticky Fluid,Mythril Mace Crafting Recipe\n" +
  "4:3:8 The Hourne Castle,Faint Memory (Yellow),Sword Citrine,Bow Citrine,Lightning Alcryst (Yellow),Spellblade's Memory (Yellow),Thief's Memory (Yellow),Prowling Wyvern Statue (Yellow),Sticky Fluid,Clear Sap,Mythril Armor Crafting Recipe\n" +
  "4:3:9 Crossing Shadows,Faint Memory (Yellow),Greatsword Citrine,Gun Citrine,Axe Citrine,Water Alcryst (Yellow),Cleric's Memory (Yellow),Ninja's Memory (Yellow),Praying Angel Statue (Yellow),Blue Spiritsand,Raging Heart,Circlet Crafting Recipe\n" +
  "4:3:10 Survive! III,Faint Memory (Yellow),Dagger Citrine,Staff Citrine,Dark Alcryst (Yellow),Ranger's Memory (Yellow),Winged One's Memory (Yellow),Warrior's Memory (Yellow),Prowling Wyvern Statue (Yellow),Raging Heart,Clear Sap,Mirage Vest Crafting Recipe\n" +
  "5:1:1 The Meaning of Strength,Faint Memory (Yellow),Fists Citrine,Mace Citrine,Light Alcryst (Yellow),Ranger's Memory (Yellow),Knight's Memory (Yellow),Praying Angel Statue (Yellow),Blue Spiritsand,Raging Heart,Mythril Helm Crafting Recipe\n" +
  "5:1:2 The Time Has Come,Faint Memory (Yellow),Sword Citrine,Spear Citrine,Dark Alcryst (Yellow),Gunner's Memory (Yellow),Paladin's Memory (Yellow),Prowling Wyvern Statue (Yellow),Sticky Fluid,Clear Sap,Fairy Ring Crafting Recipe\n" +
  "5:1:3 Assassination Squad,Faint Memory (Yellow),Greatsword Citrine,Dagger Citrine,Earth Alcryst (Yellow),Soldier's Memory (Yellow),White Mage's Memory (Yellow),Praying Angel Statue (Yellow),Blue Spiritsand,Raging Heart,Mythril Sword Crafting Recipe\n" +
  "5:1:4 Conviction,Faint Memory (Yellow),Katana Citrine,Ninja Blade Citrine,Axe Citrine,Ice Alcryst (Yellow),Black Mage's Memory (Yellow),Monk's Memory (Yellow),Prowling Wyvern Statue (Yellow),Sticky Fluid,Clear Sap,Mythril Saber Crafting Recipe\n" +
  "5:1:5 Northward Bound,Faint Memory (Yellow),Fists Citrine,Bow Citrine,Wind Alcryst (Yellow),Red Mage's Memory (Yellow),Samurai's Memory (Yellow),Viking's Memory (Yellow),Praying Angel Statue (Yellow),Blue Spiritsand,Raging Heart,Kiku-ichimonji Crafting Recipe\n" +
  "5:1:6 Spark of the Dragon,Faint Memory (Yellow),Spear Citrine,Gun Citrine,Fire Alcryst (Yellow),Green Mage's Memory (Yellow),Lancer's Memory (Yellow),Prowling Wyvern Statue (Yellow),Sticky Fluid,Clear Sap,Mythril Claws Crafting Recipe\n" +
  "5:1:7 First Things First,Faint Memory (Yellow),Dagger Citrine,Staff Citrine,Lightning Alcryst (Yellow),Time Mage's Memory (Yellow),Dragoon's Memory (Yellow),Praying Angel Statue (Yellow),Blue Spiritsand,Raging Heart,Mythril Spear Crafting Recipe,Mythril Axe Crafting Recipe\n" +
  "5:1:8 The Wounded Lion I,Faint Memory (Yellow),Ninja Blade Citrine,Mace Citrine,Water Alcryst (Yellow),Spellblade's Memory (Yellow),Thief's Memory (Yellow),Prowling Wyvern Statue (Yellow),Sticky Fluid,Clear Sap,Mythril Dagger Crafting Recipe\n" +
  "5:1:9 Vengeance,Faint Memory (Yellow),Sword Citrine,Bow Citrine,Light Alcryst (Yellow),Cleric's Memory (Yellow),Ninja's Memory (Yellow),Praying Angel Statue (Yellow),Blue Spiritsand,Raging Heart,Kodachi Crafting Recipe\n" +
  "5:1:10 The Wounded Lion II,Faint Memory (Yellow),Greatsword Citrine,Gun Citrine,Dark Alcryst (Yellow),Ranger's Memory (Yellow),Winged One's Memory (Yellow),Warrior's Memory (Yellow),Prowling Wyvern Statue (Yellow),Sticky Fluid,Clear Sap,Great Bow Crafting Recipe\n" +
  "5:2:1 When Forces Collide,Faint Memory (Yellow),Katana Citrine,Staff Citrine,Raging Heart,Blue Spiritsand,Knight's Memory (Yellow),Praying Angel Statue (Yellow),Gunner's Memory (Yellow),Earth Alcryst (Yellow),Vega Crafting Recipe\n" +
  "5:2:2 Killer of the North,Faint Memory (Yellow),Fists Citrine,Mace Citrine,Sticky Fluid,Clear Sap,Paladin's Memory (Yellow),Prowling Wyvern Statue (Yellow),White Mage's Memory (Yellow),Ice Alcryst (Yellow),Mythril Mace Crafting Recipe\n" +
  "5:2:3 Spies Afoot I,Faint Memory (Yellow),Spear Citrine,Axe Citrine,Raging Heart,Blue Spiritsand,Soldier's Memory (Yellow),Praying Angel Statue (Yellow),Black Mage's Memory (Yellow),Wind Alcryst (Yellow),Mythril Armor Crafting Recipe\n" +
  "5:2:4 Spies Afoot II,Faint Memory (Yellow),Sword Citrine,Dagger Citrine,Sticky Fluid,Clear Sap,Monk's Memory (Yellow),Prowling Wyvern Statue (Yellow),Red Mage's Memory (Yellow),Fire Alcryst (Yellow),Circlet Crafting Recipe\n" +
  "5:2:5 Spies Afoot III,Faint Memory (Yellow),Greatsword Citrine,Ninja Blade Citrine,Raging Heart,Blue Spiritsand,Samurai's Memory (Yellow),Praying Angel Statue (Yellow),Green Mage's Memory (Yellow),Lightning Alcryst (Yellow),Mirage Vest Crafting Recipe\n" +
  "5:2:6 Endowed Strength,Faint Memory (Yellow),Katana Citrine,Bow Citrine,Sticky Fluid,Clear Sap,Lancer's Memory (Yellow),Prowling Wyvern Statue (Yellow),Time Mage's Memory (Yellow),Water Alcryst (Yellow),Mythril Helm Crafting Recipe\n" +
  "5:2:7 Ambush,Faint Memory (Yellow),Fists Citrine,Gun Citrine,Raging Heart,Blue Spiritsand,Dragoon's Memory (Yellow),Praying Angel Statue (Yellow),Spellblade's Memory (Yellow),Light Alcryst (Yellow),Fairy Ring Crafting Recipe\n" +
  "5:2:8 Swelling Abhorrence I,Faint Memory (Yellow),Staff Citrine,Spear Citrine,Sticky Fluid,Clear Sap,Thief's Memory (Yellow),Prowling Wyvern Statue (Yellow),Cleric's Memory (Yellow),Dark Alcryst (Yellow),Mythril Axe Crafting Recipe\n" +
  "5:2:9 Swelling Abhorrence II,Faint Memory (Yellow),Dagger Citrine,Mace Citrine,Raging Heart,Blue Spiritsand,Ninja's Memory (Yellow),Praying Angel Statue (Yellow),Viking's Memory (Yellow),Earth Alcryst (Yellow),Mythril Sword Crafting Recipe\n" +
  "5:2:10 Last Resort,Faint Memory (Yellow),Ninja Blade Citrine,Axe Citrine,Sticky Fluid,Clear Sap,Warrior's Memory (Yellow),Prowling Wyvern Statue (Yellow),Ranger's Memory (Yellow),Ice Alcryst (Yellow),Mythril Saber Crafting Recipe,Winged One's Memory (Yellow)";

var stories = {};
var uniqueMaterials = [];
rawCsv = rawCsv.split("\n");
rawCsv.forEach(function (value) {
  var storyMaterials = value.split(',');
  var storyName = storyMaterials.shift();
  stories[storyName] = storyMaterials;

  storyMaterials.forEach(function (storyMaterial) {
    if (!storyMaterial) {
      return;
    }

    if (!uniqueMaterials.includes(storyMaterial)) {
      uniqueMaterials.push(storyMaterial);
    }
  });
});

uniqueMaterials.sort();

var charJobCsv = 'Lorenzo,Earth,Dragoon,Lancer,Time Mage\n' +
  'Mont Leonis,Earth,Lord,Paladin,Knight\n' +
  'Etre,Earth,Monk,Cleric,Knight\n' +
  'Baelo,Earth,Knight,Warrior,Paladin\n' +
  'Murmur,Earth,Red Mage,Black Mage,Lancer\n' +
  'Vadim,Earth,Thief,Warrior,Samurai\n' +
  'Aileen,Earth,Lancer,Warrior,Soldier\n' +
  'Lilyth,Fire,Knight,Soldier,Hunter\n' +
  'Margritte,Fire,Time Mage,Black Mage,Red Mage\n' +
  'Yshtola,Fire,Sorceress,White Mage,Gree Mage\n' +
  'Miche,Fire,Black Mage,Thief,Hunter\n' +
  'Naiah,Fire,White Mage,Cleric,Red Mage\n' +
  'Oelde Leonis,Fire,Lancer,Monk,Samurai\n' +
  'Khury Wezette,Ice,Hunter,Dragoon,Gree Mage\n' +
  'Nasha,Ice,Paladin,White Mage,Dragoon\n' +
  'Vallaide,Ice,Green Mage,White Mage,Red Mage\n' +
  'Serjes,Ice,Lancer,Paladin,Cleric\n' +
  'Mediena,Ice,Black Mage,Green Mage,Ninja\n' +
  'Gilgamesh,Ice,Winged One,Time Mage,Soldier\n' +
  'Vistralle,Light,Thief,Red Mage,Soldier\n' +
  'Grace,Light,White Mage,Green Mage,Lancer\n' +
  'Fina,Light,White Mage of Lapis,Gunner,Cleric\n' +
  'Phoebe,Light,Time Mage,Dragoon,White Mage\n' +
  'Macherie Hourne,Light,Cleric,Monk,Black Mage\n' +
  'Thancred,Light,Gunbreaker,Dragoon,Red Mage\n' +
  'Engelbert,Light,Paladin,Knight,Monk\n' +
  'Robb Hourne,Light,Samurai,Soldier,Lancer\n' +
  'Rairyuu,Dark,Gunner,Thief,Red Mage\n' +
  'Shadowlynx,Dark,Ninja,Dragoon,Samurai\n' +
  'Little Leela,Dark,Spellblade,Knight,White Mage\n' +
  'Xiza,Dark,Monk,Thief,Lancer\n' +
  'Sterne Leonis,Dark,Soldier,Dragoon,Ninja\n' +
  'Meriluke,Thunder,Monk,Knight,Gree Mage\n' +
  'Owe,Thunder,Samurai,Warrior,Ninja\n' +
  'Schuzelt,Thunder,Soldier,Knight,Hunter\n' +
  'Learte,Thunder,Hunter,Lancer,White Mage\n' +
  'Frederika,Thunder,Gunner,Ninja,Hunter\n' +
  'Ramada,Water,Lancer,Spellblade,Thief\n' +
  'Zazan,Water,Warrior,Knight,Thief\n' +
  'Severo,Water,Black Mage,Red Mage,Monk\n' +
  'Yuni,Water,Hunter,Black Mage,Spellblade\n' +
  'Cadia,Wind,Cleric,White Mage,Spellblade\n' +
  'Helena Leonis,Wind,Green Mage,Time Mage,White Mage\n' +
  'Mia,Wind,Thief,Cleric,Spellblade\n' +
  'Sosha,Wind,Dragoon,Warrior,Hunter\n' +
  'Yerma,Wind,Viking,Knight,Thief\n' +
  'Ayaka,Wind,White Mage,Green Mage,Time Mage';

var charPropMap = {};
charJobCsv = charJobCsv.split("\n");
charJobCsv.sort();
charJobCsv.forEach(function (value) {
  var charProps = value.split(',');
  var charName = charProps.shift();
  charPropMap[charName] = charProps;
});


var itemRecipeMap = {
  'Capella': [
    'Capella Crafting Recipe',
    'Grey Spiritsand'
  ],
  'Circlet': [
    'Circlet Crafting Recipe',
    'Murky Fluid',
    'Sticky Fluid'
  ],
  'Claymore': [
    'Claymore Crafting Recipe',
    'Cloudy Sap'
  ],
  'Dagger': [
    'Dagger Crafting Recipe',
    'Sorrowful Heart'
  ],
  'Fairy Ring': [
    'Fairy Ring Crafting Recipe',
    'Sorrowful Heart',
    'Raging Heart'
  ],
  'Great Bow': [
    'Great Bow Crafting Recipe',
    'Murky Fluid',
    'Sticky Fluid'
  ],
  'Hero\'s Ring': [
    'Hero\'s Ring Crafting Recipe',
    'Sorrowful Heart'
  ],
  'Iron Helm': [
    'Iron Helm Crafting Recipe',
    'Murky Fluid'
  ],
  'Iron Mace': [
    'Iron Mace Crafting Recipe',
    'Cloudy Sap'
  ],
  'Iron Plate': [
    'Iron Plate Crafting Recipe',
    'Sorrowful Heart'
  ],
  'Iron Rod': [
    'Iron Rod Crafting Recipe',
    'Murky Fluid'
  ],
  'Kiku-ichimonji': [
    'Kiku-ichimonji Crafting Recipe',
    'Cloudy Sap',
    'Clear Sap'
  ],
  'Kodachi': [
    'Kodachi Crafting Recipe',
    'Cloudy Sap',
    'Clear Sap'
  ],
  'Kotetsu': [
    'Kotetsu Crafting Recipe',
    'Cloudy Sap'
  ],
  'Kunai': [
    'Kunai Crafting Recipe',
    'Cloudy Sap'
  ],
  'Long Bow': [
    'Long Bow Crafting Recipe',
    'Murky Fluid'
  ],
  'Longsword': [
    'Longsword Crafting Recipe',
    'Sorrowful Heart'
  ],
  'Metal Knuckles': [
    'Metal Knuckles Crafting Recipe',
    'Grey Spiritsand'
  ],
  'Mirage Vest': [
    'Mirage Vest Crafting Recipe',
    'Grey Spiritsand',
    'Blue Spiritsand'
  ],
  'Mythril Armor': [
    'Mythril Armor Crafting Recipe',
    'Sorrowful Heart',
    'Raging Heart'
  ],
  'Mythril Axe': [
    'Mythril Axe Crafting Recipe',
    'Cloudy Sap',
    'Clear Sap'
  ],
  'Mythril Claws': [
    'Mythril Claws Crafting Recipe',
    'Grey Spiritsand',
    'Blue Spiritsand'
  ],
  'Mythril Dagger': [
    'Mythril Dagger Crafting Recipe',
    'Sorrowful Heart',
    'Raging Heart'
  ],
  'Mythril Helm': [
    'Mythril Helm Crafting Recipe',
    'Murky Fluid',
    'Sticky Fluid'
  ],
  'Mythril Mace': [
    'Mythril Mace Crafting Recipe',
    'Cloudy Sap',
    'Clear Sap'
  ],
  'Mythril Saber': [
    'Mythril Saber Crafting Recipe',
    'Cloudy Sap',
    'Clear Sap'
  ],
  'Mythril Spear': [
    'Mythril Spear Crafting Recipe',
    'Murky Fluid',
    'Sticky Fluid'
  ],
  'Mythril Sword': [
    'Mythril Sword Crafting Recipe',
    'Sorrowful Heart',
    'Raging Heart'
  ],
  'Ogrekiller': [
    'Ogrekiller Crafting Recipe',
    'Cloudy Sap'
  ],
  'Partisan': [
    'Partisan Crafting Recipe',
    'Murky Fluid'
  ],
  'Platinum Rod': [
    'Platinum Rod Crafting Recipe',
    'Velvety Fluid',
    'Malboro Tentacle',
    'Void Cryst',
  ],
  'Scholar Robe': [
    'Scholar Robe Crafting Recipe',
    'Grey Spiritsand'
  ],
  'Vega': [
    'Vega Crafting Recipe',
    'Grey Spiritsand',
    'Blue Spiritsand'
  ],
  'Wizard\'s Hat': [
    'Wizard\'s Hat Crafting Recipe',
    'Murky Fluid'
  ],
};

// Handle on document ready.
(function ($) {
  uniqueMaterials.forEach(function (material) {
    var option = '<option value="' + material + '">' + material + '</option>';
    $('#materials').append(option);
  });

  for (let [jobName, jobNameMats] of Object.entries(jobMats)) {
    var option = '<option value="' + jobName + '">Job: ' + jobName + '</option>';
    $('#materials').append(option);
  }

  for (let [charName, charProps] of Object.entries(charPropMap)) {
    var option = '<option value="' + charName + '">Character: ' + charName + '</option>';
    $('#materials').append(option);
  }

  for (let [itemName, charProps] of Object.entries(itemRecipeMap)) {
    var option = '<option value="' + itemName + '">Equip: ' + itemName + '</option>';
    $('#materials').append(option);
  }

  var selectEl = document.querySelector('#materials');
  accessibleAutocomplete.enhanceSelectElement({
    autoselect: true,
    confirmOnBlur: false,
    displayMenu: 'overlay',
    defaultValue: "",
    minLength: 3,
    selectElement: selectEl
  });

  var materialsList = [];
  var matchedStories = {};

  loadFromLocalStorage();

  /**
   * Adds material in text input to array and DOM.
   */
  function addMaterialFromInput() {
    var $materials = $('#materials');

    var material = $materials.val();
    material = cleanMaterialName(material);

    $materials.focus();

    // For some reason the value won't clear on the same frame, so we offset 1ms.
    setTimeout(function () {
      $materials.val('');
    }, 1);

    if (!material) {
      return;
    }

    // Check to see if this is a job, character, or item and do a batch-add.
    if (material.indexOf('Job: ') === 0) {
      material = material.replace('Job: ', '');
      addJobMaterials(material);
      return;
    }

    if (material.indexOf('Character: ') === 0) {
      material = material.replace('Character: ', '');
      addCharacterMaterials(material);
      return;
    }

    if (material.indexOf('Equip: ') === 0) {
      material = material.replace('Equip: ', '');
      addItemMaterials(material);
      return;
    }

    addMaterial(material);
  }

  /**
   * Sanitize and standarize material name.
   *
   * @param material
   * @returns {string}
   */
  function cleanMaterialName(material) {
    material = material.trim();
    material = material.replace(/(<([^>]+)>)/ig, "");
    return material;
  }

  /**
   * Put a material on the materials list and add to DOM.
   *
   * @param material
   */
  function addMaterial(material) {
    material = cleanMaterialName(material);
    if (materialsList.includes(material)) {
      return;
    }

    materialsList.push(material);
    addMaterialToDom(material);
    updateLocalStorage();
    calculate();
  }

  /**
   * Add all materials related to a job name.
   *
   * @param jobName
   */
  function addJobMaterials(jobName) {
    if (!jobMats.hasOwnProperty(jobName)) {
      return;
    }

    jobMats[jobName].forEach(addMaterial);
  }

  /**
   * Add all materials related to a character name.
   *
   * @param charName
   */
  function addCharacterMaterials(charName) {
    if (!charPropMap.hasOwnProperty(charName)) {
      return;
    }

    // Duplicate property array to make it easier to work with.
    var charProps = charPropMap[charName].slice();

    // First prop is the character element.
    var element = charProps.shift();
    addElementMaterials(element);

    // Rest of the props are job names.
    charProps.forEach(addJobMaterials);
  }

  /**
   * Add all materials related to an element.
   *
   * @param elementName
   */
  function addElementMaterials(elementName) {
    if (!elementMap.hasOwnProperty(elementName)) {
      return;
    }

    elementMap[elementName].forEach(addMaterial);
  }

  /**
   * Add all materials related to an item name.
   *
   * @param itemName
   */
  function addItemMaterials(itemName) {
    if (!itemRecipeMap.hasOwnProperty(itemName)) {
      return;
    }

    itemRecipeMap[itemName].forEach(addMaterial);
  }

  /**
   * Updates the DOM to show the passed material.
   *
   * @param material
   */
  function addMaterialToDom(material) {
    var materialItem = applyTemplate('template-material-item', {
      'material': material,
      'materialLabel': getMaterialImageOrLabel(material, true),
    });

    $('.materials-list').append(materialItem);
  }

  /**
   * Gets the material's img element or a text label if no image available.
   *
   * @param material
   * @param includeText
   */
  function getMaterialImageOrLabel(material, includeText) {
    if (!itemImageMap.hasOwnProperty(material)) {
      return material;
    }

    // We don't have images for all materials, so return the label if empty.
    if (!itemImageMap[material]) {
      return material;
    }

    // Coerce the image layers to be uniformly arrays.
    var layers = itemImageMap[material];
    if (!Array.isArray(itemImageMap[material])) {
      layers = [itemImageMap[material]];
    }

    var layerHtml = '';
    layers.forEach(function (layer) {
      layerHtml += getMaterialSingleImageHtml(material, layer);
    });

    var html = applyTemplate('template-material-icon-wrapper', {
      'layers': layerHtml,
      'includedText': includeText ? material : ''
    });

    return html;
  }

  /**
   * Defines a utility function to build a single material icon layer.
   *
   * @param material
   * @param image
   * @returns {string}
   */
  function getMaterialSingleImageHtml(material, image) {
    var typeClass = '';
    if (image.indexOf('job/') >= 0) {
      typeClass = 'material-icon-job';
    }
    if (image.indexOf('gear/') >= 0) {
      typeClass = 'material-icon-gear';
    }
    if (image.indexOf('itemicon_job_') >= 0) {
      typeClass = 'material-icon-memory';
    }

    return applyTemplate('template-material-icon-single', {
      'image': image,
      'typeClass': typeClass,
      'material': material
    });
  }

  /**
   * Delete material from array and DOM.
   */
  function deleteMaterial() {
    var $parent = $(this).parents('.input-group').first();
    var material = $parent.data('material');
    $parent.remove();
    materialsList.splice(materialsList.findIndex(a => a === material), 1);
    updateLocalStorage();
    calculate();
  }

  /**
   * Take the list of materials and figure out which story quests match.
   */
  function calculate() {
    if (!materialsList.length) {
      $('.feedback').html('<div class="alert alert-danger" role="alert">Add materials first.</div>');
      return;
    }

    $('.feedback').html('');

    matchedStories = {};

    for (let [storyName, storyMaterials] of Object.entries(stories)) {
      let matchedMaterials = storyMaterials.filter(x => materialsList.includes(x));
      if (!matchedMaterials.length) {
        continue;
      }

      matchedStories[storyName] = matchedMaterials;
    }

    var sortedMatchedStories = Object.keys(matchedStories)
      .map(function (k) {
        return {key: k, value: matchedStories[k]};
      })
      .sort(function (a, b) {
        return b.value.length - a.value.length;
      });

    $('.story-quest-list tbody').html('');
    sortedMatchedStories.forEach(function (matchedStory) {
      var storyName = matchedStory['key'];
      var storyMaterials = matchedStory['value'];
      var allMats = stories[storyName];

      var storyMaterialIcons = [];
      storyMaterials.forEach(function (storyMaterial) {
        storyMaterialIcons.push(getMaterialImageOrLabel(storyMaterial));
      });

      var allMatsLabels = [];
      allMats.forEach(function (storyMaterial) {
        var escaped = getMaterialImageOrLabel(storyMaterial, true).replace(/"/g, "&quot;");
        allMatsLabels.push(escaped);
      });

      var tableRow = applyTemplate('template-material-table-row', {
        'storyName': storyName,
        'storyMaterialsLength': storyMaterials.length,
        'storyMaterialIcons': storyMaterialIcons.join(' '),
        'allMatsLabels': allMatsLabels.join('<br>'),
      });

      $('.story-quest-list tbody').append(tableRow);
    });

    $('[data-toggle="tooltip"]').tooltip();
  }

  /**
   * Clear all selected materials from array, localStorage, and DOM.
   */
  function clearAll() {
    if (!confirm('Are you sure you want to clear all selected materials?')) {
      return;
    }

    $('.materials-list').html('');
    materialsList = [];
    $('.story-quest-list tbody').html('');

    updateLocalStorage();
  }

  /**
   * Store the selected materials in local storage.
   */
  function updateLocalStorage() {
    localStorage.setItem('selectedMaterials', JSON.stringify(materialsList));
  }

  /**
   * Load the selected materials from local storage.
   */
  function loadFromLocalStorage() {
    var savedMaterials = localStorage.getItem('selectedMaterials');
    if (!savedMaterials) {
      return;
    }

    materialsList = JSON.parse(savedMaterials);
    if (!materialsList.length) {
      return;
    }

    materialsList.forEach(addMaterialToDom);
    calculate();
  }

  /**
   * Parses the list of materials and adds them as materials to search on.
   */
  function doImport() {
    var importList = $('#import').val();
    if (!importList) {
      return;
    }

    importList = importList.split(',');
    importList.forEach(function (importMaterial) {
      addMaterial(importMaterial);
    });

    updateLocalStorage();
  }

  /**
   * Populates the export textarea with current list of materials.
   */
  function populateExport() {
    $('#export').text(materialsList.join(','));
  }


  /**
   * For a given template, populate the template then return the HTML to be
   * inserted.
   *
   * @param templateClass
   * @param replacements
   * @returns {*}
   */
  function applyTemplate(templateClass, replacements) {
    var $template = $('.' + templateClass);
    var templateHtml = $template.html();

    for (let [key, value] of Object.entries(replacements)) {
      key = '{{' + key + '}}';
      var re = new RegExp(key.replace(/([.?*+^$[\]\\(){}|-])/g, "\\$1"), "g");
      templateHtml = templateHtml.replace(re, value);
    }

    return templateHtml;
  }


  $(document).ready(function () {
    var $body = $('body');

    $body.on('click', '.nav-main a', function(e) {
      e.preventDefault();
      $('.nav-main a').removeClass('active');
      $(this).addClass('active');
    });

    $body.on('click', '.toggle-dark-mode', function(e) {
      $('.toggle-dark-mode').hide();
      $('.toggle-light-mode').show();
      $('body').addClass('dark-mode');
      localStorage.setItem('darkMode', '1');
    });

    $body.on('click', '.toggle-light-mode', function(e) {
      $('.toggle-dark-mode').show();
      $('.toggle-light-mode').hide();
      $('body').removeClass('dark-mode');
      localStorage.setItem('darkMode', '');
    });

    if (localStorage.getItem('darkMode') === '1') {
      $('.toggle-dark-mode').hide();
      $('.toggle-light-mode').show();
      $('body').addClass('dark-mode');
    }

    $body.on('click', '.btn-add', addMaterialFromInput);
    $body.on('click', '.materials-list .btn-close', deleteMaterial);
    $body.on('click', '.btn-clear-all', clearAll);
    $body.on('click', '.btn-export', populateExport);

    $body.on('click', '.nav-search', function (e) {
      $('.mode').hide();
      $('.mode-autocomplete').show();
      $('.autocomplete__input').focus();
    });

    $body.on('click', '.nav-import', function (e) {
      $('.mode').hide();
      $('.mode-import').show();
      $('#import').focus();
    });

    $body.on('click', '.nav-export', function (e) {
      $('.mode').hide();
      $('.mode-export').show();
      populateExport();
      var exportString = $('#export').focus().select().text();
      navigator.clipboard.writeText(exportString);
    });

    $body.on('click', '.btn-mode-cancel', function(e) {
      e.preventDefault();
      $('.mode').hide();
      $('.mode-autocomplete').show();
      $('.nav-main a').removeClass('active');
      $('.nav-main a:first-child').addClass('active');
      $('.autocomplete__input').focus();
    });

    $body.on('click', '.btn-import', function(e) {
      doImport();
      calculate();
      $('.mode-autocomplete').show();
      $('.mode-import').hide();
    });

    // On enter press, don't submit form but instead add material.
    $body.on('keypress', '#materials', function (e) {
      if (e.keyCode != 13) {
        return;
      }

      e.preventDefault();
      addMaterialFromInput();
      calculate();
    });
  });

}(jQuery));
